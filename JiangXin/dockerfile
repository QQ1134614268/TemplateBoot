# 使用官方的 Maven 镜像作为基础镜像
FROM maven:3.6.3-jdk-8 AS build
# 将当前目录设置为工作目录
WORKDIR /app
# 将本地 Maven 项目的 pom.xml 和 src 目录复制到 Docker 容器的 /app 目录下
COPY pom.xml /app
COPY src /app/src
## 设置Maven的镜像源
#ENV MAVEN_OPTS="-Dmaven.repo.local=/root/.m2/repository -Dmaven.wagon.http.ssl.insecure=true -Dmaven.wagon.http.ssl.allowall=true"
#ENV MAVEN_CONFIG="/usr/share/maven/conf/settings.xml"
## 将你的settings.xml文件复制到容器中,
#COPY settings.xml ${MAVEN_CONFIG}
#RUN mvn clean package -DskipTests -s /root/.m2/settings.xml -Dmaven.repo.local=/path/to/my/repo

# 在 Docker 容器中构建 Maven 项目
RUN mvn clean package -DskipTests

# 使用一个轻量级的 JDK 镜像作为基础镜像
FROM openjdk:8-jre-slim
# 设置工作目录
WORKDIR /app
RUN mkdir -p data/upload
RUN mkdir -p data/log
# 将 Maven 容器中的 target/*.jar 复制到 Docker 容器的 /app 目录下
COPY --from=build /app/target/*.jar /app/JiangxinServe.jar
# 暴露端口
EXPOSE 29090
# 在容器启动时运行 jar 包
CMD ["java", "-jar", "-Dactive=pro", "JiangxinServe.jar"]

# docker build -t JiangxinServe:20240613 .
# docker run -d --name JiangxinServe -p 29090:29090 -v /app/jiangxin/data:/app/data jiangxin:20240613
